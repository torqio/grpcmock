# Code generated by protoc-gen-grpcmock. DO NOT EDIT.
FROM --platform=$BUILDPLATFORM golang:1.18 as builder
ARG GOPRIVATE

# Those args comes from docker buildx (with --platform flag), including BUILDPLATFORM arg
ARG TARGETOS
ARG TARGETARCH

ENV GOPRIVATE=$GOPRIVATE
ENV GOOS=$TARGETOS
ENV GOARCH=$TARGETARCH

WORKDIR /project
COPY . .

WORKDIR grpcmock_cmds

RUN --mount=type=ssh --mount=type=secret,id=git,target=/root/.gitconfig --mount=type=secret,id=knownhost,target=/root/.ssh/known_hosts go mod tidy
RUN go build -o /server

FROM --platform=$BUILDPLATFORM alpine
COPY --from=builder /server /server

ENTRYPOINT [ "/server" ]